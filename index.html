<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>–°–∏–º—É–ª—è—Ç–æ—Ä –ú–∞–≥–∞–∑–∏–Ω–∞</title>
<style>
  body {
    margin: 0; padding: 0; font-family: Arial, sans-serif;
    background: #f0f8ff;
    display: flex; flex-direction: column; align-items: center;
  }
  #startScreen, #gameScreen {
    width: 100%; max-width: 480px;
    padding: 20px;
    box-sizing: border-box;
  }
  #startScreen {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100vh;
  }
  #startScreen input {
    padding: 10px;
    font-size: 18px;
    width: 80%;
    margin-bottom: 10px;
  }
  #startScreen button {
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    background: #4a90e2;
    color: white;
    border: none;
    border-radius: 6px;
  }

  #header {
    background: #4a90e2;
    color: white;
    padding: 10px 20px;
    width: 100%;
    box-sizing: border-box;
    text-align: center;
    border-radius: 8px 8px 0 0;
  }
  #header h1 {
    margin: 0;
  }
  #header .rating {
    margin-top: 4px;
    font-size: 16px;
  }

  #balance {
    margin: 15px 0;
    font-size: 20px;
    text-align: center;
  }

  h3 {
    margin-bottom: 6px;
  }

  #products, #storage {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  .product, .storage-item {
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 7px rgba(0,0,0,0.15);
    padding: 10px;
    width: 140px;
    box-sizing: border-box;
    text-align: center;
    transition: transform 0.2s;
  }
  .product:hover, .storage-item:hover {
    transform: scale(1.05);
  }
  .product button, .storage-item button {
    margin-top: 8px;
    padding: 5px 10px;
    font-size: 14px;
    cursor: pointer;
    background: #4a90e2;
    color: white;
    border: none;
    border-radius: 6px;
  }
  .product input[type=number], .storage-item input[type=number] {
    width: 60px;
    margin-top: 6px;
    padding: 3px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  #storage {
    margin-top: 20px;
  }

  #upgradeSection {
    margin: 20px 0;
    text-align: center;
  }
  #upgradeSection button {
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    background: #4a90e2;
    color: white;
    border: none;
    border-radius: 8px;
    transition: background 0.3s;
  }
  #upgradeSection button:hover {
    background: #357ABD;
  }

  #reviews {
    margin-top: 20px;
    max-height: 150px;
    overflow-y: auto;
    background: white;
    border-radius: 8px;
    padding: 10px;
    box-sizing: border-box;
    box-shadow: 0 0 7px rgba(0,0,0,0.1);
  }
  #reviews .review {
    border-bottom: 1px solid #ddd;
    padding: 5px 0;
    font-size: 14px;
  }
  #reviews .review:last-child {
    border-bottom: none;
  }
  .stars {
    color: #f5a623;
  }

  /* –°–º–∞–π–ª–∏–∫–∏ –∫ —Ç–æ–≤–∞—Ä–∞–º */
  .emoji {
    font-size: 20px;
    margin-right: 6px;
  }
</style>
</head>
<body>

<div id="startScreen">
  <h2>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞</h2>
  <input type="text" id="shopNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞" maxlength="20" />
  <button id="startBtn">–ù–∞—á–∞—Ç—å</button>
</div>

<div id="gameScreen" style="display:none;">
  <div id="header">
    <h1 id="shopName">–ú–∞–≥–∞–∑–∏–Ω</h1>
    <div class="rating">–†–µ–π—Ç–∏–Ω–≥: <span id="ratingValue">‚Äî</span></div>
  </div>

  <div id="balance">–ë–∞–ª–∞–Ω—Å: <span id="balanceValue">50</span> –º–æ–Ω–µ—Ç</div>

  <h3>–¢–æ–≤–∞—Ä—ã –¥–ª—è –ø–æ–∫—É–ø–∫–∏</h3>
  <div id="products"></div>

  <h3>–°–∫–ª–∞–¥ (–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å <span id="storageCapacity">10</span>)</h3>
  <div id="storage"></div>

  <div id="upgradeSection">
    <button id="upgradeStorageBtn">–£–ª—É—á—à–∏—Ç—å —Å–∫–ª–∞–¥ (—Ü–µ–Ω–∞: <span id="upgradePrice">100</span> –º–æ–Ω–µ—Ç)</button>
  </div>

  <h3>–û—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h3>
  <div id="reviews"></div>
</div>

<script>
(() => {
  // --- –î–∞–Ω–Ω—ã–µ ---
  const productsData = [
    {id: 'apple', name: '–Ø–±–ª–æ–∫–æ', price: 50, emoji: 'üçé'},
    {id: 'orange', name: '–ê–ø–µ–ª—å—Å–∏–Ω', price: 50, emoji: 'üçä'},
    {id: 'coconut', name: '–ö–æ–∫–æ—Å', price: 50, emoji: 'ü••'},
    {id: 'ramen', name: '–†–∞–º–µ–Ω', price: 50, emoji: 'üçú'},
    {id: 'banana', name: '–ë–∞–Ω–∞–Ω', price: 50, emoji: 'üçå'},
    {id: 'bread', name: '–•–ª–µ–±', price: 50, emoji: 'üçû'},
    {id: 'milk', name: '–ú–æ–ª–æ–∫–æ', price: 50, emoji: 'ü•õ'},
    {id: 'cheese', name: '–°—ã—Ä', price: 50, emoji: 'üßÄ'},
    {id: 'fish', name: '–†—ã–±–∞', price: 50, emoji: 'üêü'},
    {id: 'egg', name: '–Ø–π—Ü–æ', price: 50, emoji: 'ü•ö'},
  ];

  let balance = 50;
  let storageCapacity = 10;
  let upgradePrice = 100;
  let storage = {}; // id -> {count, price}
  let reviews = []; // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ—Ç–∑—ã–≤–æ–≤

  let shopName = '–ú–∞–≥–∞–∑–∏–Ω';

  // --- –≠–ª–µ–º–µ–Ω—Ç—ã ---
  const startScreen = document.getElementById('startScreen');
  const gameScreen = document.getElementById('gameScreen');
  const shopNameElem = document.getElementById('shopName');
  const ratingValueElem = document.getElementById('ratingValue');
  const balanceValueElem = document.getElementById('balanceValue');
  const productsElem = document.getElementById('products');
  const storageElem = document.getElementById('storage');
  const storageCapacityElem = document.getElementById('storageCapacity');
  const upgradePriceElem = document.getElementById('upgradePrice');
  const upgradeStorageBtn = document.getElementById('upgradeStorageBtn');
  const reviewsElem = document.getElementById('reviews');
  const shopNameInput = document.getElementById('shopNameInput');
  const startBtn = document.getElementById('startBtn');

  // --- –§—É–Ω–∫—Ü–∏–∏ ---
  function renderProducts() {
    productsElem.innerHTML = '';
    productsData.forEach(p => {
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <span class="emoji">${p.emoji}</span><strong>${p.name}</strong><br/>
        –¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: <strong>5</strong> –º–æ–Ω–µ—Ç<br/>
        –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è): <input type="number" min="10" max="50" value="${storage[p.id]?.price ?? 50}" data-id="${p.id}" style="width: 60px;" /> <br/>
        <button data-id="${p.id}">–ö—É–ø–∏—Ç—å</button>
      `;
      productsElem.appendChild(div);
    });
  }

  function renderStorage() {
    storageElem.innerHTML = '';
    const keys = Object.keys(storage);
    if(keys.length === 0) {
      storageElem.innerHTML = '<i>–°–∫–ª–∞–¥ –ø—É—Å—Ç</i>';
      return;
    }
    keys.forEach(id => {
      const item = storage[id];
      const product = productsData.find(p => p.id === id);
      const div = document.createElement('div');
      div.className = 'storage-item';
      div.innerHTML = `
        <span class="emoji">${product.emoji}</span><strong>${product.name}</strong><br/>
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${item.count}<br/>
        –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: <input type="number" min="10" max="50" value="${item.price}" data-id="${id}" class="storage-price-input" style="width: 60px;" /><br/>
        <button data-id="${id}">–ü—Ä–æ–¥–∞—Ç—å</button>
      `;
      storageElem.appendChild(div);
    });
  }

  function renderBalance() {
    balanceValueElem.textContent = balance;
  }

  function renderStorageCapacity() {
    storageCapacityElem.textContent = storageCapacity;
  }

  function renderUpgradePrice() {
    upgradePriceElem.textContent = upgradePrice;
  }

  function renderReviews() {
    reviewsElem.innerHTML = '';
    if(reviews.length === 0) {
      reviewsElem.innerHTML = '<i>–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</i>';
      return;
    }
    reviews.forEach(r => {
      const div = document.createElement('div');
      div.className = 'review';
      div.innerHTML = `<span class="stars">${'‚òÖ'.repeat(r.stars)}${'‚òÜ'.repeat(5-r.stars)}</span> ‚Äî ${r.text}`;
      reviewsElem.appendChild(div);
    });
  }

  // –ü–æ–¥—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ (—Å—Ä–µ–¥–Ω–µ–µ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º 10 –æ—Ç–∑—ã–≤–∞–º)
  function calculateRating() {
    if(reviews.length === 0) return '‚Äî';
    const sum = reviews.reduce((a,b) => a + b.stars, 0);
    return (sum / reviews.length).toFixed(1);
  }

  // –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–æ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
  function addReview(stars, text) {
    reviews.push({stars, text});
    if(reviews.length > 10) reviews.shift();
    renderReviews();
    ratingValueElem.textContent = calculateRating();
  }

  // –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –æ–±—â–∏–π –∑–∞–Ω—è—Ç—ã–π —Å–∫–ª–∞–¥
  function storageCount() {
    return Object.values(storage).reduce((a,b) => a + b.count, 0);
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–≥—Ä—ã—à–∞: –µ—Å–ª–∏ –º–æ–Ω–µ—Ç 0 –∏ —Å–∫–ª–∞–¥ –ø—É—Å—Ç
  function checkLose() {
    if(balance <= 0 && storageCount() === 0) {
      alert('–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –ò–≥—Ä–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞.');
      location.reload();
    }
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∫—É–ø–∫–∏ —Ç–æ–≤–∞—Ä–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 5 –º–æ–Ω–µ—Ç –∑–∞ –ø–æ–∫—É–ø–∫—É)
  function buyProduct(id) {
    if(balance < 5) {
      alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ (–Ω—É–∂–Ω–æ 5).');
      return;
    }
    if(storageCount() >= storageCapacity) {
      alert('–°–∫–ª–∞–¥ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω, —Å–¥–µ–ª–∞–π—Ç–µ –∞–ø–≥—Ä–µ–π–¥ –∏–ª–∏ –ø—Ä–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—ã.');
      return;
    }
    balance -= 5;
    if(storage[id]) {
      storage[id].count++;
    } else {
      storage[id] = {count:1, price: 50};
    }
    renderBalance();
    renderStorage();
    renderProducts(); // –ß—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∏ —Å–∫–ª–∞–¥–µ
  }

  // –ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–≤–∞—Ä–∞:  
  // –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ü–µ–Ω—ã –Ω–∞ —Ç–æ–≤–∞—Ä –≤ —Å–∫–ª–∞–¥–µ  
  // –ß–µ–º –±–ª–∏–∂–µ —Ü–µ–Ω–∞ –∫ 10, —Ç–µ–º –ª—É—á—à–µ –æ—Ç–∑—ã–≤ –∏ –≤—ã—à–µ —à–∞–Ω—Å –ø—Ä–æ–¥–∞–∂–∏  
  function sellProduct(id) {
    if(!storage[id] || storage[id].count === 0) {
      alert('–¢–æ–≤–∞—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ.');
      return;
    }

    const price = storage[id].price;
    if(price < 10) storage[id].price = 10;
    if(price > 50) storage[id].price = 50;

    // –°–ø—Ä–æ—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ü–µ–Ω—ã:  
    // –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂–∏ = 1 - (—Ü–µ–Ω–∞-10)/40 (–æ—Ç 1 –ø—Ä–∏ —Ü–µ–Ω–µ 10 –¥–æ 0 –ø—Ä–∏ —Ü–µ–Ω–µ 50)  
    const saleChance = 1 - (price - 10) / 40;
    if(Math.random() > saleChance) {
      // –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –Ω–µ –∫—É–ø–∏–ª ‚Äî –ø–ª–æ—Ö–æ–π –æ—Ç–∑—ã–≤  
      addReview(1, `–°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ–π ${productsData.find(p => p.id === id).name}.`);
      alert('–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–æ—Å—á–∏—Ç–∞–ª —Ü–µ–Ω—É —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ–π –∏ –Ω–µ –∫—É–ø–∏–ª —Ç–æ–≤–∞—Ä.');
      return;
    }

    // –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞
    storage[id].count--;
    balance += price;

    // –û—Ç–∑—ã–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ü–µ–Ω—ã:  
    // —Ü–µ–Ω–∞ –±–ª–∏–∂–µ –∫ 10 ‚Äî 5 –∑–≤—ë–∑–¥, –±–ª–∏–∂–µ –∫ 50 ‚Äî 1 –∑–≤–µ–∑–¥–∞ (–ª–∏–Ω–µ–π–Ω–æ)  
    const stars = Math.round(5 - ((price - 10) / 40) * 4);
    const positiveComments = [
      '–û—Ç–ª–∏—á–Ω—ã–π —Ç–æ–≤–∞—Ä!',
      '–û—á–µ–Ω—å –¥–æ–≤–æ–ª–µ–Ω –ø–æ–∫—É–ø–∫–æ–π!',
      '–•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ.',
      '–¶–µ–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è, –ø–æ–∫—É–ø–∞—é –µ—â—ë.',
      '–ë—É–¥—É —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –¥—Ä—É–∑—å—è–º.'
    ];
    const negativeComments = [
      '–°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ.',
      '–ù–µ —Å—Ç–æ–∏—Ç —Å–≤–æ–∏—Ö –¥–µ–Ω–µ–≥.',
      '–ü–æ–∫—É–ø–∞—Ç—å –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é.',
      '–¶–µ–Ω–∞ –∑–∞–≤—ã—à–µ–Ω–∞.',
      '–ñ–¥–∞–ª —Å–∫–∏–¥–æ–∫, –Ω–æ –Ω–µ—Ç.'
    ];

    const text = stars >= 4 ? positiveComments[Math.floor(Math.random()*positiveComments.length)] : negativeComments[Math.floor(Math.random()*negativeComments.length)];
    addReview(stars, text);

    if(storage[id].count === 0) {
      delete storage[id];
    }
    renderBalance();
    renderStorage();
    renderProducts(); // —á—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã
    checkLose();
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞ (—á–µ—Ä–µ–∑ input –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∏ —Å–∫–ª–∞–¥–µ)
  function updatePrice(id, newPrice) {
    if(!storage[id]) {
      storage[id] = {count:0, price: newPrice};
    } else {
      storage[id].price = newPrice;
    }
    renderStorage();
    renderProducts();
  }

  // –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞
  function upgradeStorage() {
    if(balance < upgradePrice) {
      alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç. –ù—É–∂–Ω–æ ${upgradePrice}.`);
      return;
    }
    balance -= upgradePrice;
    storageCapacity += 10;
    upgradePrice += 100;

    renderBalance();
    renderStorageCapacity();
    renderUpgradePrice();
  }

  // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ---
  startBtn.onclick = () => {
    const name = shopNameInput.value.trim();
    if(name.length === 0) {
      alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞');
      return;
    }
    shopName = name;
    shopNameElem.textContent = shopName;
    startScreen.style.display = 'none';
    gameScreen.style.display = 'block';
    renderProducts();
    renderStorage();
    renderBalance();
    renderStorageCapacity();
    renderUpgradePrice();
    renderReviews();
    ratingValueElem.textContent = '‚Äî';
  };

  upgradeStorageBtn.onclick = upgradeStorage;

  productsElem.addEventListener('click', e => {
    if(e.target.tagName === 'BUTTON') {
      const id = e.target.getAttribute('data-id');
      buyProduct(id);
    }
  });

  storageElem.addEventListener('click', e => {
    if(e.target.tagName === 'BUTTON') {
      const id = e.target.getAttribute('data-id');
      sellProduct(id);
    }
  });

  productsElem.addEventListener('change', e => {
    if(e.target.tagName === 'INPUT' && e.target.hasAttribute('data-id')) {
      const id = e.target.getAttribute('data-id');
      let val = parseInt(e.target.value);
      if(isNaN(val)) val = 50;
      if(val < 10) val = 10;
      if(val > 50) val = 50;
      e.target.value = val;
      updatePrice(id, val);
    }
  });

  storageElem.addEventListener('change', e => {
    if(e.target.tagName === 'INPUT' && e.target.classList.contains('storage-price-input')) {
      const id = e.target.getAttribute('data-id');
      let val = parseInt(e.target.value);
      if(isNaN(val)) val = 50;
      if(val < 10) val = 10;
      if(val > 50) val = 50;
      e.target.value = val;
      updatePrice(id, val);
    }
  });
})();
</script>

</body>
</html>
